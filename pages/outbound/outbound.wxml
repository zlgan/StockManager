<!-- 主要内容区域 -->
<view class="container">
  <form bindsubmit="submitForm">
    <view class="card">
      <!-- 单据号 -->
      <view class="form-group">
        <view class="form-label">单据号</view>
        <view class="form-control-wrapper">
          <input class="form-control bg-gray flex-grow" value="{{billNo}}" disabled name="billNo" />
        </view>
      </view>
      
      <!-- 出库类型 -->
      <view class="form-group">
        <view class="form-label">出库类型 <text class="required">*</text></view>
        <picker bindchange="bindTypeChange" value="{{typeIndex}}" range="{{typeOptions}}">
          <view class="form-control picker">
            {{typeIndex > -1 ? typeOptions[typeIndex] : '请选择出库类型'}}
          </view>
        </picker>
      </view>
      
      <!-- 出库日期 -->
      <view class="form-group">
        <view class="form-label">出库日期 <text class="required">*</text></view>
        <picker mode="date" bindchange="bindDateChange" value="{{date}}">
          <view class="form-control picker">{{date}}</view>
        </picker>
      </view>
      
      <!-- 客户 -->
      <view class="form-group">
        <view class="form-label">客户</view>
        <picker bindchange="bindCustomerChange" value="{{customerIndex}}" range="{{customerOptions}}">
          <view class="form-control picker">
            {{customerIndex > -1 ? customerOptions[customerIndex] : '请选择客户'}}
          </view>
        </picker>
      </view>
    </view>
    
    <!-- 产品信息 -->
    <view class="card">
      <view class="card-header">
        <view class="card-title">产品信息</view>
        <view class="btn-text" bindtap="addProduct">
          <text class="icon-add"></text> 添加产品
        </view>
      </view>
      
      <block wx:for="{{products}}" wx:key="index">
        <view class="product-card">
          <!-- 产品编号 -->
          <view class="product-number">#{{products.length - index}}</view>
          <!-- 产品型号 -->
          <view class="form-group">
            <view class="form-label">产品型号</view>
            <view class="form-row">
              <input class="form-control flex-grow" placeholder="请输入产品型号 / 扫一扫" value="{{item.model}}" bindinput="inputModel" data-index="{{index}}" />
              <view class="btn-icon" bindtap="scanModel" data-index="{{index}}">
                <image class="scan-image" src="/images/scan.png" mode="aspectFit"></image>
              </view>
            </view>
          </view>
          
          <!-- 产品名称 -->
          <view class="form-group">
            <view class="form-label">产品名称 <text class="required">*</text></view>
            <view class="form-row">
              <input class="form-control flex-grow" placeholder="请输入产品名称" value="{{item.name}}" bindinput="inputName" data-index="{{index}}" />
            </view>
          </view>
          
          <!-- 产品图片（只读） -->
          <view class="form-group image-group">
          <view class="form-row image-group">
            <view class="form-label inline-label">产品图片</view>
            <image src="{{item.imageUrl}}" mode="aspectFill" class="product-image" bindtap="previewImage" data-index="{{index}}"></image>
          </view>
          </view>
          
          <!-- 库存数量 -->
          <view class="form-group">
            <view class="form-label">库存数量</view>
            <view class="form-row">
              <input class="form-control bg-gray flex-grow" value="{{item.stock || 0}}" disabled />
            </view>
          </view>
          
          <!-- 出库数量 -->
          <view class="form-group">
            <view class="form-label">出库数量 <text class="required">*</text></view>
            <view class="form-row">
              <input class="form-control flex-grow" type="number" placeholder="请输入数量" value="{{item.quantity}}" bindinput="inputQuantity" data-index="{{index}}" />
            </view>
          </view>
          
          <!-- 出库单价 -->
          <view class="form-group">
            <view class="form-label">出库单价 <text class="required">*</text></view>
            <view class="price-input">
              <text class="price-symbol">¥</text>
              <input class="form-control flex-grow" type="digit" placeholder="请输入单价" value="{{item.price}}" bindinput="inputPrice" data-index="{{index}}" />
            </view>
          </view>
          
          <!-- 删除按钮 -->
          <view class="delete-btn" bindtap="deleteProduct" data-index="{{index}}">
            <text class="icon-delete"></text> 删除
          </view>
        </view>
      </block>
    </view>
    
    <!-- 备注 -->
    <view class="card">
      <view class="form-group textarea-group">
        <view class="form-label">备注</view>
        <textarea class="form-textarea" placeholder="请输入备注信息" name="remark" value="{{remark}}" />
      </view>
    </view>
    
    <!-- 总计 -->
    <view class="card total-card">
      <view class="total-row">
        <text>总数量</text>
        <text>{{totalQuantity}} 件</text>
      </view>
      <view class="total-row">
        <text>总金额</text>
        <text class="total-amount">¥ {{totalAmount}}</text>
      </view>
    </view>
    
    <!-- 提交按钮 -->
    <view class="btn-area">
      <button class="btn btn-primary" form-type="submit">确认出库</button>
    </view>
  </form>
</view>