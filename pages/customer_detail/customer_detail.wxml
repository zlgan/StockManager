<!-- 客户详情页面 -->
<view class="container">
  <view class="card">
    <!-- 客户名称 -->
    <view class="form-group">
      <text class="form-label required">客户名称</text>
      <view class="form-control-wrapper">
        <input class="form-control" placeholder="请输入客户名称" bindinput="inputCustomerName" value="{{customerInfo.name}}"/>
      </view>
    </view>

    <!-- 客户编号 -->
    <view class="form-group">
      <text class="form-label required">客户编号</text>
      <view class="form-control-wrapper">
        <input class="form-control" placeholder="请输入客户编号" bindinput="inputCustomerCode" value="{{customerInfo.code}}"/>
      </view>
    </view>

    <!-- 客户地址 -->
    <view class="form-group">
      <text class="form-label required">客户地址</text>
      <view class="form-control-wrapper">
        <input class="form-control" placeholder="请输入客户地址" bindinput="inputCustomerAddress" value="{{customerInfo.address}}"/>
      </view>
    </view>

    <!-- 联系人 -->
    <view class="form-group">
      <text class="form-label required">联系人</text>
      <view class="form-control-wrapper">
        <input class="form-control" placeholder="请输入联系人姓名" bindinput="inputContactPerson" value="{{customerInfo.contactPerson}}"/>
      </view>
    </view>

    <!-- 手机号 -->
    <view class="form-group">
      <text class="form-label required">手机号</text>
      <view class="form-control-wrapper">
        <input class="form-control" placeholder="请输入手机号" bindinput="inputPhone" value="{{customerInfo.phone}}" type="number"/>
      </view>
    </view>

    <!-- 可购买产品 -->
    <view class="form-group">
      <text class="form-label">可购买产品</text>
      <view class="form-control-wrapper">
        <view class="form-control picker-display" bindtap="showProductSelector">
          <text wx:if="{{selectedProducts.length > 0}}" class="selected-text">
            已选择 {{selectedProducts.length}} 个产品
          </text>
          <text wx:else class="placeholder-text">请选择购买的产品</text>
          <text class="picker-arrow">></text>
        </view>
      </view>
    </view>

    <!-- 已选择的产品列表 -->
    <view class="selected-products" wx:if="{{selectedProducts.length > 0}}">
      <view class="selected-products-title">已选择的产品：</view>
      <view class="product-tags">
        <view class="product-tag" wx:for="{{selectedProducts}}" wx:key="id">
          <text class="product-name">{{item.name}}</text>
          <text class="remove-product" bindtap="removeProduct" data-id="{{item.id}}">×</text>
        </view>
      </view>
    </view>

    <!-- 售后周期 -->
    <view class="form-group">
      <text class="form-label">售后周期</text>
      <view class="form-control-wrapper">
        <picker mode="selector" range="{{serviceMonthOptions}}" range-key="label" bindchange="selectServiceMonth" value="{{selectedServiceMonthIndex}}">
          <view class="form-control picker-display">
            <text wx:if="{{customerInfo.serviceMonths}}" class="selected-text">
              {{customerInfo.serviceMonths}}个月
            </text>
            <text wx:else class="placeholder-text">请选择售后周期</text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
    </view>

    <!-- 备注 -->
    <view class="form-group textarea-group">
      <text class="form-label">备注</text>
      <view class="form-control-wrapper">
        <textarea class="form-textarea" placeholder="请输入备注信息" bindinput="inputRemark" value="{{customerInfo.remark}}" maxlength="200"></textarea>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="btn-group">
      <button class="btn btn-secondary" bindtap="goBack">取消</button>
      <button class="btn btn-primary" bindtap="saveCustomer">保存</button>
    </view>
  </view>

  <!-- 产品选择弹窗 -->
  <view class="product-selector-mask" wx:if="{{showProductModal}}" bindtap="hideProductSelector">
    <view class="product-selector-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">选择可购买产品</text>
        <text class="modal-close" bindtap="hideProductSelector">×</text>
      </view>
      
      <view class="modal-content">
        <view class="product-list">
          <view class="product-item" wx:for="{{productList}}" wx:key="id">
            <view class="product-checkbox" bindtap="toggleProduct" data-id="{{item.id}}">
              <view class="checkbox {{item.selected ? 'checked' : ''}}">
                <text class="checkmark" wx:if="{{item.selected}}">✓</text>
              </view>
              <view class="product-info">
                <text class="product-name">{{item.name}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary modal-btn" bindtap="hideProductSelector">取消</button>
        <button class="btn btn-primary modal-btn" bindtap="confirmProductSelection">确定</button>
      </view>
    </view>
  </view>
</view>